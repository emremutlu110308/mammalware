import os
import requests
from termcolor import colored

#this scripts downloads the malware binaries incase having a private_api_key and a hash list.

samples_directory = '/path/to/download/samples/'
vt_download_url = 'https://www.virustotal.com/vtapi/v2/file/download'
private_api_key = 'ypur_private_apikey'

if not os.path.exists(samples_directory):
    os.makedirs(samples_directory)

#read hash list.
hash_file = open("hash.txt","r")
hashes = hash_file.read().splitlines()

counter = 0

#enumarate hashes.
for hash in hashes:

	if counter == 1000:
		print(colored("*****Quota is over...Exit Process*****",'green'))
		break

	params = {'apikey':private_api_key, 'hash':hash}

	#downloaded samples name.
	sample_output_path = samples_directory + hash
	#if sample already exists.
	if os.path.exists(sample_output_path):
		print(colored("INFO already exists :", 'yellow'), colored(hash, 'white'))
		continue
	#sample is downloaded.
	response = requests.get(url=vt_download_url, params=params)
	downloaded_file = response.content

	#if download is successful.
	if response.status_code == 200:

		counter += 1
		with open(sample_output_path,'wb+') as sample_handle:
			sample_handle.write(response.content)
	#if download is not successfull.
	else:
		counter += 1
		print(colored("ERROR downloading sample :",'red'),colored(hash,'white'))

hash_file.close()
